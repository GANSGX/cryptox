
[1m[46m RUN [49m[22m [36mv4.0.12 [39m[90mC:/Projects/cryptox/server[39m

[90mstdout[2m | src/test/integration/auth.test.ts
[22m[39m[dotenv@17.2.3] injecting env (10) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | src/test/integration/auth.test.ts
[22m[39m{"level":"info","message":"‚úÖ Connected to Redis","timestamp":"2025-12-08 00:29:34"}

[90mstdout[2m | src/test/integration/auth.test.ts
[22m[39m{"level":"info","message":"‚úÖ Redis is ready","timestamp":"2025-12-08 00:29:34"}

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/register - Registration[2m > [22m[2mshould register new user with valid data
[22m[39m‚úÖ Connected to PostgreSQL

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/register - Registration[2m > [22m[2mshould register new user with valid data
[22m[39m‚úÖ Connected to PostgreSQL

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/register - Registration[2m > [22m[2mshould register new user with valid data
[22m[39m{"level":"warn","message":"JWT_SECRET appears to be weak - please use a strong random secret","timestamp":"2025-12-08 00:29:34"}

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/register - Registration[2m > [22m[2mshould register new user with valid data
[22m[39m‚úÖ First session created for new user

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/register - Registration[2m > [22m[2mshould return JWT token with correct structure
[22m[39m{"level":"warn","message":"JWT_SECRET appears to be weak - please use a strong random secret","timestamp":"2025-12-08 00:29:35"}

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/register - Registration[2m > [22m[2mshould return JWT token with correct structure
[22m[39m‚úÖ First session created for new user

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/register - Registration[2m > [22m[2mshould store auth_token in database (not plaintext password)
[22m[39m{"level":"warn","message":"JWT_SECRET appears to be weak - please use a strong random secret","timestamp":"2025-12-08 00:29:35"}

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/register - Registration[2m > [22m[2mshould store auth_token in database (not plaintext password)
[22m[39m‚úÖ First session created for new user

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/login - Login[2m > [22m[2mshould login with correct credentials
[22m[39müîç Login attempt: alice

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/login - Login[2m > [22m[2mshould login with correct credentials
[22m[39müì¶ User from DB: not found

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/login - Login[2m > [22m[2mshould reject wrong password with 401
[22m[39müîç Login attempt: alice

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/login - Login[2m > [22m[2mshould reject wrong password with 401
[22m[39müì¶ User from DB: not found

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/login - Login[2m > [22m[2mshould reject non-existent user with 401
[22m[39müîç Login attempt: nonexistent

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/login - Login[2m > [22m[2mshould reject non-existent user with 401
[22m[39müì¶ User from DB: not found

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/login - Login[2m > [22m[2mshould take similar time for invalid username and wrong password
[22m[39müîç Login attempt: nonexistent

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mPOST /api/auth/login - Login[2m > [22m[2mshould take similar time for invalid username and wrong password
[22m[39müì¶ User from DB: not found

[90mstdout[2m | src/test/integration/auth.test.ts[2m > [22m[2mAuth API - Integration & Security Tests[2m > [22m[2mJWT Token Security[2m > [22m[2mshould reject invalid JWT format
[22m[39m{"level":"warn","message":"JWT_SECRET appears to be weak - please use a strong random secret","timestamp":"2025-12-08 00:29:41"}
{"level":"warn","message":"JWT verify: Invalid token header","timestamp":"2025-12-08 00:29:41"}

 [31m‚ùØ[39m src/test/integration/auth.test.ts [2m([22m[2m35 tests[22m[2m | [22m[31m20 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 10894[2mms[22m[39m
       [33m[2m‚úì[22m[39m should register new user with valid data [33m 514[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return JWT token with correct structure [33m 445[2mms[22m[39m
       [33m[2m‚úì[22m[39m should store auth_token in database (not plaintext password) [33m 445[2mms[22m[39m
[31m       [31m√ó[31m should reject duplicate username with 409[39m[33m 307[2mms[22m[39m
[31m       [31m√ó[31m should reject duplicate email with 409[39m[32m 289[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid username format[39m[33m 330[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid email format[39m[33m 307[2mms[22m[39m
[31m       [31m√ó[31m should reject short password (< 8 chars)[39m[32m 295[2mms[22m[39m
[31m       [31m√ó[31m should reject missing fields[39m[32m 299[2mms[22m[39m
       [33m[2m‚úì[22m[39m should block SQL injection in username [33m 335[2mms[22m[39m
[31m       [31m√ó[31m should sanitize XSS in username[39m[33m 311[2mms[22m[39m
[31m       [31m√ó[31m should normalize email to lowercase[39m[32m 292[2mms[22m[39m
[31m       [31m√ó[31m should login with correct credentials[39m[32m 291[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject wrong password with 401 [33m 303[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject non-existent user with 401 [32m 300[2mms[22m[39m
       [33m[2m‚úì[22m[39m should take similar time for invalid username and wrong password [33m 314[2mms[22m[39m
[31m       [31m√ó[31m should block SQL injection in login[39m[33m 301[2mms[22m[39m
[31m       [31m√ó[31m should reject missing username[39m[33m 302[2mms[22m[39m
[31m       [31m√ó[31m should reject missing password[39m[32m 291[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow 100 requests per minute (global) [33m 454[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should block request 1001 with 429 (Too Many Requests)
       [32m‚úì[39m should reject invalid JWT format[32m 292[2mms[22m[39m
[31m       [31m√ó[31m should reject missing Bearer prefix[39m[32m 284[2mms[22m[39m
[31m       [31m√ó[31m should reject tampered JWT token[39m[32m 284[2mms[22m[39m
       [32m‚úì[39m should reject missing Authorization header[32m 278[2mms[22m[39m
[31m       [31m√ó[31m should allow authenticated user to access protected route[39m[32m 282[2mms[22m[39m
       [33m[2m‚úì[22m[39m should block unauthenticated user from protected route [33m 305[2mms[22m[39m
[31m       [31m√ó[31m should handle malformed JSON payload[39m[33m 327[2mms[22m[39m
[31m       [31m√ó[31m should handle empty payload[39m[32m 290[2mms[22m[39m
[31m       [31m√ó[31m should handle very long username (DoS attempt)[39m[33m 308[2mms[22m[39m
[31m       [31m√ó[31m should handle unicode in username[39m[33m 315[2mms[22m[39m
[31m       [31m√ó[31m should handle null values[39m[32m 297[2mms[22m[39m
       [32m‚úì[39m should include security headers in response[32m 283[2mms[22m[39m
       [32m‚úì[39m should not expose server version[32m 286[2mms[22m[39m
       [32m‚úì[39m should not expose stack trace in error[32m 296[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m20 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (35)[39m
[2m   Start at [22m 00:29:32
[2m   Duration [22m 12.59s[2m (transform 384ms, setup 34ms, collect 1.36s, tests 10.89s, environment 0ms, prepare 30ms)[22m

